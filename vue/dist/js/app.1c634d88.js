(function(e){function t(t){for(var r,i,a=t[0],c=t[1],u=t[2],m=0,d=[];m<a.length;m++)i=a[m],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&d.push(n[i][0]),n[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(d.length)d.shift()();return s.push.apply(s,u||[]),o()}function o(){for(var e,t=0;t<s.length;t++){for(var o=s[t],r=!0,a=1;a<o.length;a++){var c=o[a];0!==n[c]&&(r=!1)}r&&(s.splice(t--,1),e=i(i.s=o[0]))}return e}var r={},n={app:0},s=[];function i(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=r,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(o,r,function(t){return e[t]}.bind(null,r));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;s.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},2511:function(e,t,o){"use strict";o("9e10")},"3e34":function(e,t,o){"use strict";o("fc43")},"56d7":function(e,t,o){"use strict";o.r(t);o("e260"),o("e6cf"),o("cca6"),o("a79d");var r=o("2b0e"),n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[o("splash-create-room",{directives:[{name:"show",rawName:"v-show",value:"create-room"===e.view,expression:"view === 'create-room'"}]}),o("splash-join-room",{directives:[{name:"show",rawName:"v-show",value:"join-room"===e.view,expression:"view === 'join-room'"}]}),e.room?o("control-panel",{directives:[{name:"show",rawName:"v-show",value:"room"===e.view,expression:"view === 'room'"}]}):e._e()],1)},s=[],i=o("b85c"),a=o("1da1"),c=(o("96cf"),o("2b3d"),o("d3b7"),o("3ca3"),o("ddb0"),o("841c"),o("ac1f"),o("159b"),function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"splash-screen"},[o("div",{staticClass:"content"},[o("div",{staticClass:"centered"},[o("h1",[e._v("Create Room")]),o("select",{directives:[{name:"model",rawName:"v-model",value:e.roomCreate.overlayId,expression:"roomCreate.overlayId"}],attrs:{placeholder:"Overlay ID"},on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.roomCreate,"overlayId",t.target.multiple?o:o[0])}}},e._l(e.overlays,(function(t){return o("option",{key:t,domProps:{value:t}},[e._v(e._s(t))])})),0),o("input",{directives:[{name:"model",rawName:"v-model",value:e.roomCreate.name,expression:"roomCreate.name"}],attrs:{type:"text",placeholder:"Your Name"},domProps:{value:e.roomCreate.name},on:{input:function(t){t.target.composing||e.$set(e.roomCreate,"name",t.target.value)}}}),o("button",{on:{click:function(t){return e.createRoomAs(e.roomCreate.overlayId,e.roomCreate.name)}}},[e._v("Create Room")])])]),o("div",{staticClass:"background"})])}),u=[],l={data:function(){return{roomCreate:{overlayId:null,name:""}}},computed:{overlays:function(){return this.$store.getters.overlays},socket:function(){return this.$store.getters.socket}},methods:{createRoomAs:function(e,t){this.socket.emit("create.room",{id:e,name:t})}}},m=l,d=(o("2511"),o("2877")),f=Object(d["a"])(m,c,u,!1,null,"453235e2",null),v=f.exports,p=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"splash-screen"},[o("div",{staticClass:"content"},[o("div",{staticClass:"centered"},[o("h1",[e._v("Join Room")]),o("input",{directives:[{name:"model",rawName:"v-model",value:e.roomJoin.name,expression:"roomJoin.name"}],attrs:{type:"text",placeholder:"Your Name"},domProps:{value:e.roomJoin.name},on:{input:function(t){t.target.composing||e.$set(e.roomJoin,"name",t.target.value)}}}),o("button",{on:{click:function(t){return e.joinRoomAs(e.roomJoin.roomId,e.roomJoin.name)}}},[e._v("Join Room")])])]),o("div",{staticClass:"background"})])},h=[],g={data:function(){return{roomJoin:{roomId:null,name:""}}},created:function(){var e=this;this.socket.on("server.checked.room-id",(function(t){t.roomExists&&(e.roomJoin.roomId=t.room.id,e.$store.commit("view","join-room"))}))},computed:{overlays:function(){return this.$store.getters.overlays},socket:function(){return this.$store.getters.socket}},methods:{joinRoomAs:function(e,t){this.socket.emit("join.room",{id:e,name:t})}}},w=g,y=(o("bb44"),Object(d["a"])(w,p,h,!1,null,"394e4f61",null)),b=y.exports,k=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"wrapper"}},[o("div",{staticClass:"users"},e._l(e.room.users,(function(t,r){return o("div",{key:r,staticClass:"user"},[o("span",{staticClass:"name"},[e._v(" "+e._s(t.name)+" "),t.id===e.socket.id?o("span",[e._v("(you)")]):e._e()]),t.id!==e.socket.id?o("video",{staticClass:"video",attrs:{autoplay:"",muted:"",id:"video_"+t.id},domProps:{muted:!0}}):o("video",{staticClass:"video",attrs:{autoplay:"",muted:"",id:"local-video"},domProps:{muted:!0}})])})),0),o("div",{staticClass:"controls"},[o("a",{attrs:{href:"/?room="+e.room.id,target:"_blank"}},[e._v("Simulate other user")])]),o("div",{staticClass:"player"}),o("div",{staticClass:"chat"}),o("div",{staticClass:"mixer"})])},C=[],x={mounted:function(){navigator.getUserMedia({video:!0,audio:!0},(function(e){document.getElementById("local-video").srcObject=e}),(function(e){console.log(e.message)}))},computed:{room:function(){return this.$store.getters.room},socket:function(){return this.$store.getters.socket}}},_=x,j=(o("3e34"),Object(d["a"])(_,k,C,!1,null,"38ede142",null)),O=j.exports,R=window,$=R.RTCPeerConnection,P=R.RTCSessionDescription,I={name:"App",data:function(){return{url:{roomId:new URLSearchParams(window.location.search).get("room")},audioContext:new AudioContext,audioOutput:null,buffers:{audio:[]},peerConnectionConfig:{iceServers:[{urls:"stun:stun.stunprotocol.org:3478"},{urls:"stun:stun.l.google.com:19302"}]}}},created:function(){var e=this;this.socket.on("join-request-answer",function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(o){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.peers.get(o.from),r){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,r.connection.setRemoteDescription(new P(o.answer));case 5:r.isConnected||(r.isConnected=!0,e.connectToPeer(o.from));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.socket.on("client.sync",(function(t){e.$store.commit("overlays",t.overlays)})),this.socket.on("room.join",(function(t){e.$store.commit("view","room");var o,r=Object(i["a"])(t.users);try{for(r.s();!(o=r.n()).done;){var n=o.value;n!==e.socket.id&&e.connectToPeer(n)}}catch(s){r.e(s)}finally{r.f()}})),this.socket.on("room.sync",(function(t){e.$store.commit("room",t.room)})),this.url.roomId&&this.socket.emit("server.check.room-id",{id:this.url.roomId}),this.socket.on("join-request-offer",function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(o){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Offer received!"),t.next=3,e.getOrCreatePeer(o.from);case 3:return r=t.sent,t.next=6,r.connection.setRemoteDescription(new P(o.offer));case 6:return t.next=8,r.connection.createAnswer();case 8:return n=t.sent,t.next=11,r.connection.setLocalDescription(new P(n));case 11:e.socket.emit("join-request-answer",{answer:n,to:o.from}),console.log("Answer sent!");case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},computed:{view:function(){return this.$store.getters.view},room:function(){return this.$store.getters.room},peers:function(){return this.$store.getters.peers},socket:function(){return this.$store.getters.socket}},methods:{connectToPeer:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function o(){var r,n;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,t.getOrCreatePeer(e);case 2:return r=o.sent,o.next=5,r.connection.createOffer();case 5:return n=o.sent,o.next=8,r.connection.setLocalDescription(new P(n));case 8:t.socket.emit("join-request-offer",{offer:n,to:e});case 9:case"end":return o.stop()}}),o)})))()},getOrCreatePeer:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function o(){var r,n;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(!t.peers.get(e)){o.next=2;break}return o.abrupt("return",t.peers.get(e));case 2:return r={socketId:e,isConnected:!1,connection:new $(t.peerConnectionConfig)},r.connection.ontrack=function(t){var o=document.getElementById("video_"+e);o&&(o.srcObject=t.streams[0],o.play())},o.prev=4,o.next=7,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 7:n=o.sent,n.getTracks().forEach((function(e){r.connection.addTrack(e,n)})),o.next=14;break;case 11:o.prev=11,o.t0=o["catch"](4),console.log(o.t0.message);case 14:return t.peers.set(e,r),o.abrupt("return",r);case 16:case"end":return o.stop()}}),o,null,[[4,11]])})))()},loadAudio:function(e){var t=this;fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return t.audioContext.decodeAudioData(e)})).then((function(e){t.buffers.audio.push(e)}))},playAudio:function(e){console.log(e);var t=this.audioContext.createBufferSource();t.buffer=this.buffers.audio[e],t.connect(this.audioOutput),t.start(),console.log(t)}},components:{SplashCreateRoom:v,SplashJoinRoom:b,ControlPanel:O}},J=I,S=(o("cf25"),Object(d["a"])(J,n,s,!1,null,null,null)),A=S.exports,T=(o("4ec9"),o("2f62"));r["a"].use(T["a"]);var D=new T["a"].Store({state:{view:"create-room",room:null,peers:new Map,overlays:[],socket:io()},getters:{view:function(e){return e.view},room:function(e){return e.room},overlays:function(e){return e.overlays},peers:function(e){return e.peers},socket:function(e){return e.socket}},actions:{},mutations:{view:function(e,t){e.view=t},room:function(e,t){e.room=t},overlays:function(e,t){e.overlays=t}}});r["a"].config.productionTip=!1,new r["a"]({store:D,render:function(e){return e(A)}}).$mount("#app")},"9e10":function(e,t,o){},bb44:function(e,t,o){"use strict";o("dcde")},cf25:function(e,t,o){"use strict";o("fea6")},dcde:function(e,t,o){},fc43:function(e,t,o){},fea6:function(e,t,o){}});
//# sourceMappingURL=app.1c634d88.js.map